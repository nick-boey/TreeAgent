@page "/sessions"
@using Homespun.Features.ClaudeCode.Data
@using Homespun.Features.ClaudeCode.Services
@using Homespun.Features.Navigation
@implements IAsyncDisposable
@rendermode InteractiveServer
@inject IClaudeSessionStore SessionStore
@inject IBreadcrumbService BreadcrumbService

<PageTitle>Sessions - Homespun</PageTitle>

<h1>Sessions</h1>

<div class="agent-management-page">
    @if (_isLoading)
    {
        <div class="flex justify-center py-5">
            <div class="spinner-border" role="status">
                <span class="sr-only">Loading sessions...</span>
            </div>
        </div>
    }
    else
    {
        <AgentManagementPanel
            OnSessionStopped="HandleSessionStopped" />
    }

    @if (!string.IsNullOrEmpty(_errorMessage))
    {
        <div class="alert alert-danger mt-3">@_errorMessage</div>
    }
</div>

@code {
    private bool _isLoading = true;
    private string? _errorMessage;

    protected override async Task OnInitializedAsync()
    {
        await BreadcrumbService.SetContextAsync(new BreadcrumbContext { PageName = "Agents" });
        _isLoading = false;
    }

    private void HandleSessionStopped()
    {
        StateHasChanged();
    }

    public ValueTask DisposeAsync()
    {
        return ValueTask.CompletedTask;
    }
}
