@using Homespun.Features.PullRequests
@using Homespun.Features.PullRequests.Data.Entities

<div class="work-item @(IsSelected ? "selected" : "") @(IsClickable ? "clickable" : "") @(IsLast ? "last" : "")"
     style="@GetIndentStyle()"
     @onclick="HandleClick">
    <div class="item-graph">
        <div class="graph-line graph-line-top @(IsFirst ? "hidden" : "")"></div>
        <div class="graph-node @StatusColor" title="@StatusTooltip"></div>
        <div class="graph-line graph-line-bottom @(IsLast ? "hidden" : "")"></div>
    </div>
    <div class="item-body">
        @if (!string.IsNullOrEmpty(Url))
        {
            <a href="@Url" target="_blank" class="item-title" @onclick:stopPropagation="true">
                @if (Number.HasValue)
                {
                    <span class="item-number">#@Number</span>
                }
                @Title
            </a>
        }
        else
        {
            <span class="item-title">
                @if (Number.HasValue)
                {
                    <span class="item-number">#@Number</span>
                }
                @Title
            </span>
        }
        @if (!string.IsNullOrEmpty(Subtitle))
        {
            <div class="item-subtitle">@Subtitle</div>
        }
    </div>
</div>

@code {
    [Parameter] public string Title { get; set; } = "";
    [Parameter] public int? Number { get; set; }
    [Parameter] public string? Url { get; set; }
    [Parameter] public string StatusColor { get; set; } = "status-default";
    [Parameter] public string? StatusTooltip { get; set; }
    [Parameter] public string? Subtitle { get; set; }
    [Parameter] public int IndentLevel { get; set; } = 0;
    [Parameter] public bool IsSelected { get; set; }
    [Parameter] public bool IsClickable { get; set; }
    [Parameter] public bool IsFirst { get; set; }
    [Parameter] public bool IsLast { get; set; }
    [Parameter] public EventCallback OnClick { get; set; }

    private string GetIndentStyle()
    {
        if (IndentLevel <= 0) return "";
        return $"margin-left: {IndentLevel * 16}px;";
    }

    private async Task HandleClick()
    {
        if (IsClickable && OnClick.HasDelegate)
        {
            await OnClick.InvokeAsync();
        }
    }
}
