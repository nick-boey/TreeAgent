@using TreeAgent.Web.Features.PullRequests
<div class="timeline-item @(IsSelected ? "selected" : "") @GetStatusClass()"
     @onclick="HandleClick">
    <div class="item-status-indicator @GetStatusClass()"></div>
    <div class="item-content">
        <div class="item-title">
            @Item.Title
            @if (Item.Number > 0)
            {
                <span class="item-number">#@Item.Number</span>
            }
        </div>
        @if (!string.IsNullOrEmpty(Item.Group))
        {
            <span class="item-group">@Item.Group</span>
        }
    </div>
    <div class="item-time">
        t=@Time
    </div>
</div>

@code {
    [Parameter]
    public PullRequestInfo Item { get; set; } = null!;

    [Parameter]
    public PullRequestStatus? Status { get; set; }

    [Parameter]
    public int Time { get; set; }

    [Parameter]
    public bool IsSelected { get; set; }

    [Parameter]
    public EventCallback OnSelected { get; set; }

    private PullRequestStatus EffectiveStatus => Status ?? Item.Status;

    private async Task HandleClick()
    {
        await OnSelected.InvokeAsync();
    }

    private string GetStatusClass()
    {
        return EffectiveStatus switch
        {
            PullRequestStatus.InProgress => "status-in-progress",
            PullRequestStatus.ReadyForReview => "status-ready-for-review",
            PullRequestStatus.ChecksFailing => "status-checks-failing",
            PullRequestStatus.Conflict => "status-conflict",
            PullRequestStatus.ReadyForMerging => "status-ready-for-merging",
            PullRequestStatus.Merged => "status-merged",
            PullRequestStatus.Closed => "status-closed",
            _ => ""
        };
    }
}
